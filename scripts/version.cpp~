#include <fstream>
#include <sstream>
#include <string>
#include <iostream>

using namespace std;

int main() {
  // getting the GNU Gama version
  ifstream input("../../gama/configure.ac");
  string line;

  while (getline(input,line)) {
    if (line.substr(0,7)=="AC_INIT")
        break;
  }

  istringstream ac_init(line);
  string gama_version;

  ac_init >> gama_version;
  ac_init >> gama_version;

  gama_version = gama_version.substr(1,gama_version.length()-3);

  // getting the QGamaCore version
  ifstream input2("../qgama-core/src/qgama-core.pro");
  while (getline(input2,line)) {
    if (line.substr(0,13)=="QGAMA_VERSION")
       break;
  }

  istringstream qgama(line);
  string qgama_version;
  qgama >> qgama_version;
  qgama >> qgama_version;
  qgama >> qgama_version;

  // writing the config.h
  ofstream output("../config.h");
  output << "#define VERSION \"" << gama_version << "\""<< endl;
  output << "#define GAMA_VERSION \"" << gama_version << "\""<< endl;
  output << "#define QGAMA_VERSION \"" << qgama_version << "\"" << endl;
}
